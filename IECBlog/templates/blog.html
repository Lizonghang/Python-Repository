<!DOCTYPE HTML><html><head>    <title>来，我给你说怎么切图</title>    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>    <meta name="description" content=""/>    <meta name="keywords" content=""/>    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:700italic,400,300,700' rel='stylesheet'          type='text/css'>    <script src="/static/admin/js/jquery.min.js"></script>    <script src="/static/admin/js/jquery.js"></script>    <link rel="stylesheet" href="/static/admin/css/exmachina/skel-noscript.css"/>    <link rel="stylesheet" href="/static/admin/css/exmachina/style.css"/>    <link rel="stylesheet" href="/static/admin/css/exmachina/style-desktop.css"/>    <link rel="stylesheet" href="/static/admin/css/screen.css"></head><body class="left-sidebar"><!-- Header --><div id="header">    <div class="container">        <!-- Logo -->        <div id="logo">            <h1><a href="javascript:void(0);">toxni'S BLOG</a></h1>        </div>        <!-- Nav -->        <nav id="nav">            <ul>                <li><a href="javascript:void(0);">Homepage</a></li>                <li class="active"><a href="javascript:void(0);">BLOG</a></li>                <li><a href="javascript:void(0);">UNDEFINED</a></li>                <li><a href="javascript:void(0);">UNDEFINED</a></li>            </ul>        </nav>    </div></div><!-- Header --><!-- Banner --><div id="banner">    <div class="container">    </div></div><!-- /Banner --><!-- Main --><div id="page">    <!-- Main -->    <div id="main" class="container">        <div class="row">            <!-- Side Block -->            <div class="3u">                <section class="sidebar">                    <header>                        <h2>近期文章</h2>                    </header>                    <ul class="style1">                        <li><a href="/blog/toxni/01/" target="_self">来，我给你说怎么切图</a></li>                        <li><a href="/blog/toxni/02/" target="_self">Linux常用指令－文件操作</a></li>                        <li><a href="/blog/toxni/03/" target="_self">Linux常用指令－用户操作</a></li>                        <li><a href="/blog/toxni/04/" target="_self">借助Bandwagon VPS科学上网</a></li>                        <li><a href="/blog/toxni/05/" target="_self">CSS_Floating *Chapter 1.1</a></li>                    </ul>                </section>                <section class="sidebar">                    <header>                        <h2>看看其它</h2>                    </header>                    <ul class="style1">                        <li><a href="javascript:void(0);">其它文章</a></li>                        <li><a href="javascript:void(0);">其它文章</a></li>                        <li><a href="javascript:void(0);">其它文章</a></li>                        <li><a href="javascript:void(0);">其它文章</a></li>                        <li><a href="javascript:void(0);">其它文章</a></li>                    </ul>                </section>            </div>            <!-- Main Article -->            <div class="9u skel-cell-important">                <section>                    <header style="text-align: center">                        <h2>来，我给你说怎么切图</h2>                        <div style="height: 20px;"></div>                        <span class="byline" id="ps">BY UESTC-IEC-TOXNI / 24 FEBRUARY 2016 on Design / <a                                href="http://www.toxni.com/" target="_blank"                                style="text-decoration: none;color: #5b80b2;">TOXNI'S BLOG</a></span>                    </header>                    <div id="article-content">                        <div>     <p style="text-align: center">         keywords: python，网络爬虫，post表单，urllib2         <br>         May 26, 2015, 11:49 a.m.     </p>     <p style="text-align: center">前言 &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp;上一篇python网络爬虫文章主要讲解了如何使用python发送<span style="color: rgb(0, 176, 80);">HTTP&nbsp; GET </span>请求并简单处理获取到的数据，其中用到了 <span style="color: rgb(0, 176, 80);">urllib</span> 和 <span style="color: rgb(0, 176, 80);">re</span> 库。http协议常用的请求中除了<span style="color: rgb(0, 176, 80);"> GET</span> 方法，还有 <span style="color: rgb(0, 176, 80);">POST</span> 方法。<span style="color: rgb(0, 176, 80);">POST </span>方法与 <span style="color: rgb(0, 176, 80);">GET </span>方法的区别网上已经有很多讲解了，这里笔者也不再赘述，简单的来说 <span style="color: rgb(0, 176, 80);">GET</span> 方法用于信息获取，<span style="color: rgb(0, 176, 80);">POST</span> 方法可能会对服务器上的资源进行修改。本篇文章以发送手机短信为例，讲解如何发送http POST请求。<br></p><p>一、准备工作<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这里笔者选用的短信服务商为云片网，关于云片网的api文档请移步这里：</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a target="_blank" href="http://www.yunpian.com/api/sms.html" style="text-decoration: none">http://www.yunpian.com/api/sms.html<br></a></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在api文档里已经有调用短信接口的python代码示例，不过示例代码中使用的是<span style="color: rgb(0, 176, 80);">urllib</span>库。因此笔者在这里使用<span style="color: rgb(0, 176, 80);">urllib2</span>进行编写，这个库也是python的标准库之一，用来处理http请求非常方便。<br></p><p>二、代码实现<br></p><code>#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-import&nbsp;urllib2import&nbsp;urlliburl&nbsp;=&nbsp;"http://yunpian.com/v1/sms/send.json"data&nbsp;=&nbsp;urllib.urlencode({'apikey':&nbsp;"***********************",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'mobile':&nbsp;'****************',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'text':&nbsp;"【云片网】您的验证码是1234"})response&nbsp;=&nbsp;urllib2.urlopen(url,&nbsp;data)print&nbsp;response.read()</code><p></p><p>三、代码讲解</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 176, 80);">apikey</span> 对应云片网账号的 apikey，<span style="color: rgb(0, 176, 80);">mobile</span> 为需要发送短信的手机号码。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 176, 80);">urllib.urlencode() </span>是将字典或包含两个元素的列表或元组转换为url参数，读者可以print一下本例的 <span style="color: rgb(0, 176, 80);">data</span>，结果输出为:</p><blockquote><p style="text-indent: 0em;"><code>“mobile=15682513909&amp;text=%E3%80%90%E4%BA%91%E7%89%87%E7%BD%91%E3%80%91%E6%82%A8%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0<br>%81%E6%98%AF1234&amp;apikey=d25fbaa9ed5025eef7b777ca73c56af3”(text输出格式为unicode)。</code></p></blockquote><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 176, 80);">urllib2.urlopen()</span>创建一个表示远程url的类文件对象，然后像本地文件一样操作这个类文件对象来获取远程数据。当只传入url参数时，该函数将使用HTTP GET向url发送请求,当同时传入url和data参数时，该函数则使用<span style="color: rgb(0, 176, 80);">HTTP POST</span>方法向url发送请求。返回为一个类文件对象，该对象提供如下方法：</p><ul style="list-style-type: disc;"><li><p><span style="color: rgb(0, 176, 80);">read(), readline(), readlines(), fileno(), close()</span>：这些方法的使用方式与文件对象完全一样，读者可以自行了解python对于文件对象的处理；</p></li><li><p><span style="color: rgb(0, 176, 80);">info()</span>：返回一个httplib.HTTPMessage对象，表示远程服务器返回的头信息；</p></li><li><p><span style="color: rgb(0, 176, 80);">getcode()</span>：返回HTTP状态码；</p></li><li><p><span style="color: rgb(0, 176, 80);">geturl()</span>：返回请求的url；</p></li></ul><p class="bg-primary">三、代码进阶<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp; 对于以上的代码urllib也能做到，而且在使用上几乎没有区别，那么这里我们对代码进行一些修改：</p><code>#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-import&nbsp;urllib2import&nbsp;urlliburl&nbsp;=&nbsp;"http://yunpian.com/v1/sms/send.json"data&nbsp;=&nbsp;urllib.urlencode({'apikey':&nbsp;"***********************",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'mobile':&nbsp;'****************',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'text':&nbsp;"【云片网】您的验证码是1234"})req&nbsp;=&nbsp;urllib2.Request(url,&nbsp;data)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;urllib2.urlopen(req)print&nbsp;response.read()</code><p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 其中我们引入了<span style="color: rgb(0, 176, 80);">Request</span>对象，并且直接在<span style="color: rgb(0, 176, 80);">urllib2.urlopen()</span>中传入<span style="color: rgb(0, 176, 80);">Request</span>对象，代码依旧能执行。在python官方的<span style="color: rgb(0, 176, 80);">urllib2</span>文档中，有这么一句话“<span style="color: rgb(0, 0, 0); font-family: sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.7999992370605px; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">Open the URL<span>&nbsp;</span></span><em style="color: rgb(0, 0, 0); font-family: sans-serif; font-size: 16px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.7999992370605px; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">url, </em><span style="color: rgb(0, 0, 0); font-family: sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.7999992370605px; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);">which can be either a string or a<span class="Apple-converted-space">&nbsp;</span></span><a class="reference internal" href="https://docs.python.org/2/library/urllib2.html#urllib2.Request" title="urllib2.Request" style="color: rgb(53, 95, 124); text-decoration: none; font-family: sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.7999992370605px; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><tt class="xref py py-class docutils literal" style="padding: 0px 1px; font-size: 0.95em; font-weight: bold; background-color: transparent;"><span class="pre">Request</span></tt></a><span style="color: rgb(0, 0, 0); font-family: sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 20.7999992370605px; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none; background-color: rgb(255, 255, 255);"><span class="Apple-converted-space">&nbsp;</span>object.</span>” 对于传入的url参数，可以直接是字符串，也可以是<span style="color: rgb(0, 176, 80);">Request</span>对象，而在<span style="color: rgb(0, 176, 80);">urllib</span>之中没有这种用法。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 对于<span style="color: rgb(0, 176, 80);">Request</span>对象，我们可以通过它来修改 HTTP 请求的 <span style="color: rgb(0, 176, 80);">header </span>和<span style="color: rgb(0, 176, 80);"> proxy</span>，这个我们在之后的文章会讲解，这里先提出这个用法，以免在以后的使用和介绍中显得突兀。</p><p class="bg-primary">四、结尾 &nbsp; &nbsp;<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp; 在结尾顺便提一下以上代码的最终结果是一个<span style="color: rgb(0, 176, 80);">json</span>字符串，使用<span style="color: rgb(0, 176, 80);">type()</span>方法返回值为<span style="color: rgb(0, 176, 80);">str</span>。可以使用python的<span style="color: rgb(0, 176, 80);">json</span>库，使用<span style="color: rgb(0, 176, 80);">json.loads()</span>将json字符串转换为数据原本的格式，本例的最终原本的数据为字典。<br></p> </div>                    </div>                </section>            </div>        </div>    </div>    <!-- Main --></div><!-- /Main --><!-- Featured --><div id="featured" style="display: block;">    <div class="container">        <div class="row">            <section class="4u">                <div class="box">                    <a href="javascript:void(0);" class="image left"><img src="/static/admin/img/exmachina/pics04.jpg"                                                                          alt=""></a>                    <h3>Etiam posuere augue</h3>                    <p>Donec nonummy magna quis risus eleifend. </p>                    <a href="javascript:void(0);" class="button">More</a>                </div>            </section>            <section class="4u">                <div class="box">                    <a href="javascript:void(0);" class="image left"><img src="/static/admin/img/exmachina/pics05.jpg"                                                                          alt=""></a>                    <h3>Etiam posuere augue</h3>                    <p>Donec nonummy magna quis risus eleifend. </p>                    <a href="javascript:void(0);" class="button">More</a>                </div>            </section>            <section class="4u">                <div class="box">                    <a href="javascript:void(0);" class="image left"><img src="/static/admin/img/exmachina/pics06.jpg"                                                                          alt=""></a>                    <h3>Etiam posuere augue</h3>                    <p>Donec nonummy magna quis risus eleifend. </p>                    <a href="javascript:void(0);" class="button">More</a>                </div>            </section>        </div>        <div class="divider"></div>    </div></div><!-- /Featured --><!-- Footer --><div id="footer" style="display: block;">    <div class="container">        <div class="row">            <div class="3u">                <section>                    <h2>toxni</h2>                    <div class="balloon">                        <blockquote>&ldquo;&nbsp;&nbsp;发发牢骚，讲讲故事，聊聊技术。&nbsp;&nbsp;&rdquo;<br><br>                            <strong>&ndash;&nbsp;&nbsp;toxni<br>&ndash;&nbsp;&nbsp;IEC前端设计师</strong></blockquote>                    </div>                    <div class="ballon-bgbtm">&nbsp;</div>                </section>            </div>            <div class="3u">                <section>                    <h2>Donec dictum</h2>                    <ul class="default">                        <li>                            <h3>Mauris vulputate dolor sit amet</h3>                            <p><a href="javascript:void(0);">Donec leo, vivamus fermentum nibh in augue praesent a lacus                                at urna congue rutrum.</a></p>                        </li>                        <li>                            <h3>Fusce ultrices fringilla metus</h3>                            <p><a href="javascript:void(0);">Donec leo, vivamus fermentum nibh in augue praesent a lacus                                at urna congue rutrum.</a></p>                        </li>                        <li>                            <h3>Donec dictum metus in sapien</h3>                            <p><a href="javascript:void(0);">Donec leo, vivamus fermentum nibh in augue praesent a lacus                                at urna congue rutrum.</a></p>                        </li>                    </ul>                </section>            </div>            <div class="3u">                <section>                    <h2>Nulla leifend</h2>                    <p>Donec placerat odio vel elit. Nullam ante orci, pellentesque eget, tempus quis, ultrices in, est.                        Curabitur sit amet nulla. Nam in massa. Sed vel tellus. Curabitur sem urna, consequat.</p>                    <ul class="style5">                        <li><a href="javascript:void(0);"><img src="/static/admin/img/exmachina/pics07.jpg"                                                               alt=""></a></li>                        <li><a href="javascript:void(0);"><img src="/static/admin/img/exmachina/pics08.jpg"                                                               alt=""></a></li>                        <li><a href="javascript:void(0);"><img src="/static/admin/img/exmachina/pics09.jpg"                                                               alt=""></a></li>                        <li><a href="javascript:void(0);"><img src="/static/admin/img/exmachina/pics10.jpg"                                                               alt=""></a></li>                        <li><a href="javascript:void(0);"><img src="/static/admin/img/exmachina/pics11.jpg"                                                               alt=""></a></li>                        <li><a href="javascript:void(0);"><img src="/static/admin/img/exmachina/pics12.jpg"                                                               alt=""></a></li>                    </ul>                    <a href="#" class="button">More Collections</a>                </section>            </div>            <div class="3u">                <section>                    <h2>Luctus eleifend</h2>                    <p><strong>Aliquam erat volutpat. Pellentesque tristique ante ut risus. </strong></p>                    <p>Quisque dictum. Integer nisl risus, sagittis convallis, rutrum id, elementum congue, nibh.                        Suspendisse dictum porta lectus. Donec placerat odio vel elit.</p>                    <p>Donec placerat odio vel elit. Nullam ante orci, pellentesque eget, tempus quis, ultrices in, est.                        Curabitur sit amet nulla. Nam in massa. Sed vel tellus. Curabitur sem urna, consequat.</p>                    <a href="javascript:void(0);" class="button">More Collections</a>                </section>            </div>        </div>    </div></div><!-- /Footer --></body></html>